<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Semanal da Igreja</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .calendar-event {
            line-height: 1.3;
        }
        .bg-event-culto { background-color: #ef4444; } /* red-500 */
        .bg-event-ebd { background-color: #6366f1; } /* indigo-500 */
        .bg-event-oracao { background-color: #14b8a6; } /* teal-500 */
        .bg-event-jovens { background-color: #f97316; } /* orange-500 */
        .bg-event-familia { background-color: #a855f7; } /* purple-500 */
        .bg-event-doutrina { background-color: #0ea5e9; } /* sky-500 */
        .text-event-aniversario { color: #ec4899; } /* pink-500 */
    </style>
</head>
<body class="bg-gray-100 p-4 md:p-6">

    <header class="fixed top-0 left-0 w-full bg-white/90 backdrop-blur-lg shadow-sm z-50 px-4 md:px-6 pt-6 pb-4 border-b border-gray-200">
        <div class="max-w-7xl mx-auto text-center">
            <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800">Painel da Igreja</h1>
            <p class="text-md md:text-lg text-gray-600 mt-1">Organiza√ß√£o Semanal e Eventos</p>
        </div>
    </header>

    <div class="pt-28 md:pt-32">
        <div class="max-w-7xl mx-auto space-y-8">

            <section id="next-event-section" class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-200">
                <h2 class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                    <svg class="w-8 h-8 mr-3 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-3.75h.008v.008H12v-.008ZM12 15h.008v.008H12v-.008Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75v-.008Zm0 2.25h.008v.008H9.75v-.008Zm2.25-4.5h.008v.008H12v-.008Zm1.5.008h.008v.008H13.5v-.008Zm0 2.25h.008v.008H13.5v-.008Z" /></svg>
                    Pr√≥ximo Evento Principal
                </h2>
                <div id="next-event-details" class="text-gray-700" aria-live="polite">
                    <p>Carregando...</p>
                </div>
            </section>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-2 space-y-8">
                    <section class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-200" aria-labelledby="calendar-heading">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
                            <h2 id="calendar-heading" class="text-xl font-semibold text-gray-700 flex items-center mb-2 sm:mb-0">
                                <svg class="w-8 h-8 mr-3 text-red-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" /></svg>
                                <span id="calendar-month-year" class="text-xl font-semibold text-gray-700"></span>
                            </h2>
                            <div class="flex space-x-1">
                                <button id="prev-month" aria-label="M√™s anterior" class="p-2 rounded-lg hover:bg-gray-200 text-gray-500 hover:text-gray-700 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
                                </button>
                                <button id="next-month" aria-label="Pr√≥ximo m√™s" class="p-2 rounded-lg hover:bg-gray-200 text-gray-500 hover:text-gray-700 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" /></svg>
                                </button>
                            </div>
                        </div>
                        <div class="grid grid-cols-7 gap-1 text-xs font-semibold text-gray-500 text-center mb-1">
                            <div>Dom</div><div>Seg</div><div>Ter</div><div>Qua</div><div>Qui</div><div>Sex</div><div>S√°b</div>
                        </div>
                        <div id="calendar-days" class="grid grid-cols-7 gap-1" role="grid" aria-live="polite">
                            {/* Dias do calend√°rio ser√£o preenchidos aqui pelo JS */}
                        </div>
                        <div class="mt-4 space-x-2 space-y-1 text-xs text-gray-600">
                            <span class="inline-flex items-center"><span class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0 bg-event-culto"></span>Culto</span>
                            <span class="inline-flex items-center"><span class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0 bg-event-ebd"></span>EBD</span>
                            <span class="inline-flex items-center"><span class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0 bg-event-oracao"></span>Ora√ß√£o</span>
                            <span class="inline-flex items-center"><span class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0 bg-event-jovens"></span>Jovens</span>
                            <span class="inline-flex items-center"><span class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0 bg-event-familia"></span>Fam√≠lia</span>
                            <span class="inline-flex items-center"><span class="w-2.5 h-2.5 rounded-full mr-1.5 flex-shrink-0 bg-event-doutrina"></span>Doutrina</span>
                            <span class="inline-flex items-center"><span class="text-event-aniversario font-bold">üéÇ</span> Anivers√°rio</span>
                        </div>
                    </section>

                     <section id="worship-schedule-section" class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-200" aria-labelledby="worship-schedule-heading">
                        <h2 id="worship-schedule-heading" class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <svg class="w-8 h-8 mr-3 text-purple-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25V12m0 0v6.75m0-6.75a3.75 3.75 0 0 1 3.75 3.75H8.25A3.75 3.75 0 0 1 12 12Z" />
                            </svg>
                            Escala de Cultos
                        </h2>
                        <div id="worship-schedule-details" class="space-y-4 text-sm text-gray-700" aria-live="polite">
                            <p>Carregando...</p>
                        </div>
                    </section>
                </div>

                <div class="lg:col-span-1 space-y-8">
                    <section class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-200" aria-labelledby="cleaning-heading">
                        <h2 id="cleaning-heading" class="text-xl font-semibold text-gray-700 mb-4 flex items-center">
                            <svg class="w-8 h-8 mr-3 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25" /></svg>
                            Escala de Limpeza Semanal
                        </h2>
                        <div id="cleaning-schedule" class="space-y-3 text-sm" aria-live="polite">
                            {/* Itens da escala de limpeza pelo JS */}
                        </div>
                    </section>

                    <section class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 border border-gray-200" aria-labelledby="birthdays-heading">
                        <div class="flex justify-between items-center mb-4">
                            <h2 id="birthdays-heading" class="text-xl font-semibold text-gray-700 flex items-center">
                                <svg class="w-8 h-8 mr-3 text-pink-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 11.25v8.25a8.25 8.25 0 0 1-16.5 0v-8.25m16.5 0a3.75 3.75 0 0 0-7.5 0m7.5 0v-.375c0-.621-.504-1.125-1.125-1.125H13.5m-4.5 0v.375c0 .621.504 1.125 1.125 1.125h2.25M12 17.25a3.75 3.75 0 0 0 2.754-6.938q.114-.05.226-.1M12 17.25a3.75 3.75 0 0 1-2.754-6.938q-.114-.05-.226-.1M9 10.5a5.23 5.23 0 0 0-1.09 3.3c0 .899.32 1.724.86 2.362a5.209 5.209 0 0 0 4.46 0 5.23 5.23 0 0 0 .86-2.362c0-1.262-.422-2.428-1.09-3.3M15 10.5a5.23 5.23 0 0 1 1.09 3.3c0 .899-.32 1.724-.86 2.362a5.209 5.209 0 0 1-4.46 0 5.23 5.23 0 0 1-.86-2.362c0-1.262.422-2.428 1.09-3.3" /></svg>
                                Aniversariantes da Semana
                            </h2>
                            <button id="download-birthdays" aria-label="Baixar resumo de aniversariantes" class="p-2 rounded-lg hover:bg-gray-200 text-gray-500 hover:text-gray-700 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                                </svg>
                            </button>
                        </div>
                        <div id="birthdays" class="space-y-3 text-sm" aria-live="polite">
                            {/* Itens de aniversariantes pelo JS */}
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <script>
    const PainelIgrejaApp = {
        config: {
            today: new Date(), // Usa a data atual do sistema
            diasDaSemana: ["Domingo", "Segunda", "Ter√ßa", "Quarta", "Quinta", "Sexta", "S√°bado"],
            mesesDoAno: ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"],
            startOfWeekMonday: true,
        },
        state: {
            currentDisplayDate: null,
        },
        data: {
            cleaningScheduleDefinition: [
                { dayOfWeek: 1, responsible: "Iara e Tain√°" },
                { dayOfWeek: 2, responsible: "N√∫bia e Aldaline" },
                { dayOfWeek: 3, responsible: "Kleverton e Alcidinei" },
                { dayOfWeek: 4, responsible: "Niro e Lucas" },
                { dayOfWeek: 5, responsible: "Deuzarina e Ana Aguiar" },
                { dayOfWeek: 6, responsible: "Jo√£o Paulo e Pedro Chagas" },
                { dayOfWeek: 0, responsible: "H√©lida, Emanuel, Wendel" }
            ],
            birthdays: [ // Dados est√°ticos de aniversariantes
                { name: "Lucas Mendes", date: "2025-05-28" },
                { name: "Fernanda Costa", date: "2025-06-01" },
                { name: "Ricardo Alves", date: "2025-05-30"},
                { name: "Beatriz Almeida", date: "2025-06-05" },
                { name: "Jo√£o Silva", date: "2025-07-15" },
            ],
            churchEvents: [ // Dados est√°ticos de eventos
                { date: "2025-05-04", time: "19:00", type: "culto", title: "Culto de Domingo", direcao: "Pr. Jo√£o", pregador: "Mission√°rio Pedro" },
                { date: "2025-05-11", time: "19:00", type: "culto", title: "Culto de Domingo (Dia M√£es)", direcao: "Di√°cono Carlos", pregador: "Pra. Maria" },
                { date: "2025-05-18", time: "19:00", type: "culto", title: "Culto de Domingo", direcao: "Presb. Antonio", pregador: "Pr. Visitante" },
                { date: "2025-05-25", time: "19:00", type: "culto", title: "Culto de Domingo", direcao: "Jovem L√≠der", pregador: "Pr. Jo√£o" },
                { date: "2025-06-01", time: "19:00", type: "culto", title: "Culto de Domingo (Ceia)", direcao: "Pr. Presidente", pregador: "Pr. Presidente" },
                { date: "2025-06-08", time: "19:00", type: "culto", title: "Culto de Domingo", direcao: "Diaconisa Ana", pregador: "Ev. Marcos" },
                { date: "2025-05-31", time: "19:00", type: "jovens", title: "Culto Jovem", preacher: "Pr. Convidado" }, // Exemplo para 31/05
                { date: "2025-05-06", time: "19:00", type: "doutrina", title: "Culto de Doutrina" },
                { date: "2025-05-13", time: "19:00", type: "doutrina", title: "Culto de Doutrina" },
                { date: "2025-05-07", time: "19:00", type: "oracao", title: "C√≠rculo de Ora√ß√£o" },
                { date: "2025-05-14", time: "19:00", type: "oracao", title: "C√≠rculo de Ora√ß√£o" },
                { date: "2025-05-03", time: "19:00", type: "jovens", title: "Culto Jovem" },
                { date: "2025-05-04", time: "09:00", type: "ebd", title: "EBD" },
            ]
        },
        utils: {
            parseDate: (dateString) => {
                if (!dateString) return null;
                const parts = dateString.split('-');
                if (parts.length !== 3) return null;
                return new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
            },
            formatDate: (dateObj, format = "DD/MM/AAAA") => {
                if (!dateObj || !(dateObj instanceof Date)) return "";
                const day = String(dateObj.getDate()).padStart(2, '0');
                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                const year = dateObj.getFullYear();
                if (format === "AAAA-MM-DD") return `${year}-${month}-${day}`;
                return `${day}/${month}/${year}`;
            },
            createElement: (tag, classList = [], attributes = {}, textContent = null) => {
                const el = document.createElement(tag);
                const flatClassList = classList.flatMap(c => (typeof c === 'string' ? c.split(' ') : []));
                if (flatClassList.length > 0) {
                    el.classList.add(...flatClassList.filter(c => c));
                }
                for (const key in attributes) {
                    el.setAttribute(key, attributes[key]);
                }
                if (textContent) el.textContent = textContent;
                return el;
            }
        },
        renderNextEvent: function() {
            const detailsContainer = document.getElementById('next-event-details');
            if (!detailsContainer) { console.error("Elemento #next-event-details n√£o encontrado."); return; }
            detailsContainer.innerHTML = '';
            
            const now = new Date(this.config.today);
            const todayFormatted = this.utils.formatDate(this.config.today, "AAAA-MM-DD");

            // Prioridade para "Culto de Hoje"
            let nextEvent = this.data.churchEvents
                .map(event => ({ ...event, dateTime: new Date(`${event.date}T${event.time || '00:00'}:00`) }))
                .find(event => 
                    event.date === todayFormatted && 
                    event.title === "Culto de Hoje" && 
                    event.dateTime >= now
                );

            if (!nextEvent) { // Se n√£o houver "Culto de Hoje" ou j√° passou, busca o pr√≥ximo evento principal
                const upcomingPrincipalEvents = this.data.churchEvents
                    .map(event => ({ ...event, dateTime: new Date(`${event.date}T${event.time || '00:00'}:00`) }))
                    .filter(event => event.dateTime >= now && 
                                    (event.type === 'culto' || event.type === 'jovens' || event.type === 'familia' || event.type === 'doutrina') &&
                                    !(event.date === todayFormatted && event.title === "Culto de Hoje") // Evita duplicar se j√° foi considerado
                    )
                    .sort((a, b) => a.dateTime - b.dateTime);
                if (upcomingPrincipalEvents.length > 0) {
                    nextEvent = upcomingPrincipalEvents[0];
                }
            }
            
            if (nextEvent) {
                const dayName = this.config.diasDaSemana[nextEvent.dateTime.getDay()];
                const fragment = document.createDocumentFragment();
                let p = this.utils.createElement('p', ['text-lg', 'font-semibold', `text-${nextEvent.type === 'jovens' ? 'orange' : 'blue'}-600`], {}, nextEvent.title); // Cor din√¢mica simples
                fragment.appendChild(p);
                p = this.utils.createElement('p', ['text-sm', 'text-gray-600', 'mt-1']);
                p.innerHTML = `<strong>Data:</strong> ${dayName}, ${this.utils.formatDate(nextEvent.dateTime)}`;
                fragment.appendChild(p);
                p = this.utils.createElement('p', ['text-sm', 'text-gray-600']);
                p.innerHTML = `<strong>Hor√°rio:</strong> ${nextEvent.time}`;
                fragment.appendChild(p);

                // Mostrar pregador/dire√ß√£o se aplic√°vel e n√£o for o "Culto de Hoje" (que tem detalhes na sua pr√≥pria se√ß√£o)
                if (nextEvent.title !== "Culto de Hoje") {
                    if (nextEvent.preacher) {
                        p = this.utils.createElement('p', ['text-sm', 'text-gray-600', 'mt-1']);
                        p.innerHTML = `<strong>Preletor:</strong> ${nextEvent.preacher}`;
                        fragment.appendChild(p);
                    }
                } else { // Para o "Culto de Hoje", mostrar dire√ß√£o e pregador aqui tamb√©m se for o pr√≥ximo
                     if (nextEvent.direcao) {
                        p = this.utils.createElement('p', ['text-sm', 'text-gray-600', 'mt-1']);
                        p.innerHTML = `<strong>Dire√ß√£o:</strong> ${nextEvent.direcao}`;
                        fragment.appendChild(p);
                    }
                    if (nextEvent.pregador) {
                        p = this.utils.createElement('p', ['text-sm', 'text-gray-600', 'mt-1']);
                        p.innerHTML = `<strong>Pregador:</strong> ${nextEvent.pregador}`;
                        fragment.appendChild(p);
                    }
                }
                detailsContainer.appendChild(fragment);
            } else {
                detailsContainer.textContent = "Nenhum evento principal programado.";
            }
        },
        renderCleaningSchedule: function() {
            const scheduleContainer = document.getElementById('cleaning-schedule');
            if (!scheduleContainer) { console.error("Elemento #cleaning-schedule n√£o encontrado."); return; }
            scheduleContainer.innerHTML = '';
            const todayDayOfWeek = this.config.today.getDay();
            const fragment = document.createDocumentFragment();
            const orderedSchedule = [...this.data.cleaningScheduleDefinition].sort((a, b) => {
                let dayA = a.dayOfWeek; let dayB = b.dayOfWeek;
                if (this.config.startOfWeekMonday) { dayA = (dayA === 0) ? 7 : dayA; dayB = (dayB === 0) ? 7 : dayB; }
                return dayA - dayB;
            });
            orderedSchedule.forEach(item => {
                const isCurrentDay = item.dayOfWeek === todayDayOfWeek;
                const itemDiv = this.utils.createElement('div', ['py-2', 'pl-3', 'border-l-4', isCurrentDay ? 'border-blue-500 bg-blue-50 rounded-r-md' : 'border-gray-300']);
                let dayName = this.config.diasDaSemana[item.dayOfWeek];
                if (isCurrentDay) dayName += " (Hoje)";
                const pDay = this.utils.createElement('p', ['font-semibold', isCurrentDay ? 'text-blue-600' : 'text-gray-800'], {}, dayName);
                const pResponsible = this.utils.createElement('p', ['text-xs', 'text-gray-600']);
                pResponsible.innerHTML = `<span class="font-medium">${item.responsible}</span>`;
                itemDiv.appendChild(pDay); itemDiv.appendChild(pResponsible); fragment.appendChild(itemDiv);
            });
            scheduleContainer.appendChild(fragment);
        },

        renderWorshipSchedule: function() {
            const detailsContainer = document.getElementById('worship-schedule-details');
            if (!detailsContainer) { console.error("Elemento #worship-schedule-details n√£o encontrado."); return; }
            detailsContainer.innerHTML = '';
            const now = new Date(this.config.today);
            now.setHours(0,0,0,0); 

            const upcomingServices = this.data.churchEvents
                .filter(event => event.type === 'culto')
                .map(event => ({ ...event, dateTime: new Date(`${event.date}T${event.time || '00:00'}:00`) }))
                .filter(event => event.dateTime >= now)
                .sort((a, b) => a.dateTime - b.dateTime)
                .slice(0, 5); 

            if (upcomingServices.length > 0) {
                const fragment = document.createDocumentFragment();
                const todayDateString = this.config.today.toDateString();

                upcomingServices.forEach(service => {
                    const isTodayService = service.dateTime.toDateString() === todayDateString;
                    const dayName = this.config.diasDaSemana[service.dateTime.getDay()];
                    const formattedDate = this.utils.formatDate(service.dateTime);
                    
                    const serviceClasses = ['p-3', 'rounded-md', 'border', 'border-gray-200'];
                    let titleClasses = ['font-semibold'];
                    let textClasses = [];

                    if (isTodayService) {
                        serviceClasses.push(`bg-event-${service.type}`, 'text-white');
                        titleClasses.push('text-white'); // Garante que o t√≠tulo tamb√©m seja branco
                        textClasses.push('text-gray-100'); // Para o texto dos detalhes
                    } else {
                        serviceClasses.push('bg-gray-50');
                        titleClasses.push('text-purple-700');
                        textClasses.push('text-gray-700');
                    }

                    const serviceDiv = this.utils.createElement('div', serviceClasses);
                    
                    let titleText = `${service.title} - ${dayName}, ${formattedDate} √†s ${service.time}`;
                    if (isTodayService) titleText += " (Hoje)";
                    let titleP = this.utils.createElement('p', titleClasses, {}, titleText);
                    serviceDiv.appendChild(titleP);

                    if (service.direcao) {
                        let direcaoP = this.utils.createElement('p', ['mt-1', ...textClasses]);
                        direcaoP.innerHTML = `<strong>Dire√ß√£o:</strong> ${service.direcao}`;
                        serviceDiv.appendChild(direcaoP);
                    }
                    if (service.pregador) {
                        let pregadorP = this.utils.createElement('p', ['mt-1', ...textClasses]);
                        pregadorP.innerHTML = `<strong>Pregador:</strong> ${service.pregador}`;
                        serviceDiv.appendChild(pregadorP);
                    }
                    fragment.appendChild(serviceDiv);
                });
                detailsContainer.appendChild(fragment);
            } else {
                detailsContainer.textContent = "Nenhuma escala de culto programada para os pr√≥ximos dias.";
            }
        },

        renderBirthdays: function() {
            const birthdayContainer = document.getElementById('birthdays');
            if (!birthdayContainer) { console.error("Elemento #birthdays n√£o encontrado."); return; }
            birthdayContainer.innerHTML = '';
            const todayRef = new Date(this.config.today); todayRef.setHours(0, 0, 0, 0);
            const startOfWeek = new Date(todayRef);
            const dayOffset = this.config.startOfWeekMonday ? (todayRef.getDay() === 0 ? -6 : 1 - todayRef.getDay()) : -todayRef.getDay();
            startOfWeek.setDate(todayRef.getDate() + dayOffset);
            const endOfWeek = new Date(startOfWeek); endOfWeek.setDate(startOfWeek.getDate() + 6); endOfWeek.setHours(23, 59, 59, 999);
            const fragment = document.createDocumentFragment();
            const weekBirthdays = this.data.birthdays
                .map(b => ({ ...b, parsedDate: this.utils.parseDate(b.date) }))
                .filter(b => b.parsedDate && b.parsedDate >= startOfWeek && b.parsedDate <= endOfWeek)
                .sort((a, b) => a.parsedDate - b.parsedDate);

            if (weekBirthdays.length === 0) {
                birthdayContainer.appendChild(this.utils.createElement('p', ['text-gray-500', 'text-xs'], {}, 'Nenhum aniversariante nesta semana.'));
                return;
            }
            weekBirthdays.forEach(b => {
                const isToday = b.parsedDate.toDateString() === todayRef.toDateString();
                const itemDiv = this.utils.createElement('div', ['py-2', isToday ? 'bg-pink-50 text-pink-700 rounded-md p-2' : '']);
                let dateString = `${this.config.diasDaSemana[b.parsedDate.getDay()]}, ${b.parsedDate.getDate()} de ${this.config.mesesDoAno[b.parsedDate.getMonth()]}`;
                if (isToday) dateString += " (Hoje! üéâ)";
                const pName = this.utils.createElement('p', ['font-semibold', isToday ? 'text-pink-700' : 'text-gray-800'], {}, b.name);
                const pDate = this.utils.createElement('p', ['text-xs', isToday ? 'text-pink-600' : 'text-gray-600'], {}, dateString);
                itemDiv.appendChild(pName); itemDiv.appendChild(pDate); fragment.appendChild(itemDiv);
            });
            birthdayContainer.appendChild(fragment);
        },
        downloadBirthdaysSummary: function() {
            const todayRef = new Date(this.config.today); todayRef.setHours(0, 0, 0, 0);
            const startOfWeek = new Date(todayRef);
            const dayOffset = this.config.startOfWeekMonday ? (todayRef.getDay() === 0 ? -6 : 1 - todayRef.getDay()) : -todayRef.getDay();
            startOfWeek.setDate(todayRef.getDate() + dayOffset);
            const endOfWeek = new Date(startOfWeek); endOfWeek.setDate(startOfWeek.getDate() + 6); endOfWeek.setHours(23, 59, 59, 999);

            const weekBirthdays = this.data.birthdays
                .map(b => ({ ...b, parsedDate: this.utils.parseDate(b.date) }))
                .filter(b => b.parsedDate && b.parsedDate >= startOfWeek && b.parsedDate <= endOfWeek)
                .sort((a, b) => a.parsedDate - b.parsedDate);

            if (weekBirthdays.length === 0) {
                console.log("Nenhum aniversariante na semana para baixar."); // Idealmente, use um modal/toast
                return;
            }

            let summaryText = "Aniversariantes da Semana:\n\n";
            weekBirthdays.forEach(b => {
                summaryText += `${b.name} - ${this.utils.formatDate(b.parsedDate)} (${this.config.diasDaSemana[b.parsedDate.getDay()]})\n`;
            });

            const blob = new Blob([summaryText], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `aniversariantes_semana_${this.utils.formatDate(startOfWeek, "DDMMYYYY")}_a_${this.utils.formatDate(endOfWeek, "DDMMYYYY")}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        },
        renderCalendar: function() {
            const calendarDaysContainer = document.getElementById('calendar-days');
            const calendarMonthYearEl = document.getElementById('calendar-month-year');
            if (!calendarDaysContainer || !calendarMonthYearEl) { console.error("Elementos do calend√°rio n√£o encontrados."); return; }
            calendarDaysContainer.innerHTML = ''; const fragment = document.createDocumentFragment();
            calendarMonthYearEl.textContent = `${this.config.mesesDoAno[this.state.currentDisplayDate.getMonth()]} ${this.state.currentDisplayDate.getFullYear()}`;
            calendarDaysContainer.setAttribute('aria-label', `Calend√°rio de ${calendarMonthYearEl.textContent}`);
            const year = this.state.currentDisplayDate.getFullYear(); const month = this.state.currentDisplayDate.getMonth();
            const firstDayOfMonth = new Date(year, month, 1); const lastDayOfMonth = new Date(year, month + 1, 0);
            const daysInMonth = lastDayOfMonth.getDate(); let startDayOfWeek = firstDayOfMonth.getDay();
            let displayStartOffset = startDayOfWeek;
            const todayRef = new Date(this.config.today); todayRef.setHours(0,0,0,0);
            const prevMonthLastDay = new Date(year, month, 0).getDate();
            for (let i = 0; i < displayStartOffset; i++) {
                const day = prevMonthLastDay - displayStartOffset + 1 + i;
                const dayEl = this.utils.createElement('div', ['min-h-[90px]', 'p-1', 'rounded-md', 'bg-gray-50', 'border', 'border-gray-200', 'flex', 'flex-col', 'items-start', 'text-xs']);
                dayEl.setAttribute('role', 'gridcell'); dayEl.setAttribute('aria-label', `${day} (m√™s anterior)`);
                dayEl.appendChild(this.utils.createElement('span', ['font-semibold', 'text-gray-400', 'self-end', 'p-1', 'leading-none'], {}, day.toString()));
                fragment.appendChild(dayEl);
            }
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDate = new Date(year, month, day);
                const dayClasses = ['min-h-[90px]', 'p-1', 'rounded-md', 'border', 'flex', 'flex-col', 'items-start', 'text-xs', 'hover:bg-gray-50', 'transition-colors'];
                let ariaLabelDay = `${day} de ${this.config.mesesDoAno[month]}, ${this.config.diasDaSemana[currentDate.getDay()]}`;
                if (currentDate.toDateString() === todayRef.toDateString()) { dayClasses.push('bg-blue-500', 'border-blue-600'); } else { dayClasses.push('bg-white', 'border-gray-200'); }
                const dayEl = this.utils.createElement('div', dayClasses); dayEl.setAttribute('role', 'gridcell');
                const dayNumberClasses = ['font-semibold', 'self-end', 'p-0.5', 'leading-none', 'w-6', 'h-6', 'flex', 'items-center', 'justify-center', 'rounded-full'];
                if (currentDate.toDateString() === todayRef.toDateString()) { dayNumberClasses.push('bg-blue-500', 'text-white'); } else { dayNumberClasses.push('text-gray-700'); }
                dayEl.appendChild(this.utils.createElement('span', dayNumberClasses, {}, day.toString()));
                const eventsOnThisDay = this.data.churchEvents.filter(e => e.date === this.utils.formatDate(currentDate, "AAAA-MM-DD"));
                const birthdaysOnThisDay = this.data.birthdays.filter(b => {
                    const bDate = this.utils.parseDate(b.date);
                    return bDate && bDate.getDate() === day && bDate.getMonth() === month && bDate.getFullYear() === year;
                });
                let eventInfosForAria = []; const eventsContainer = this.utils.createElement('div', ['w-full', 'mt-0.5', 'space-y-0.5', 'overflow-hidden']);
                eventsOnThisDay.forEach(event => {
                    const eventDiv = this.utils.createElement('div', ['calendar-event', `bg-event-${event.type}`, 'text-white', 'text-[0.7rem]', 'px-1', 'py-0.5', 'rounded', 'truncate', 'w-full'], {}, event.title);
                    eventDiv.setAttribute('title', `${event.title} √†s ${event.time}`);
                    eventsContainer.appendChild(eventDiv); eventInfosForAria.push(`${event.title} √†s ${event.time}`);
                });
                if (birthdaysOnThisDay.length > 0) {
                    const bDayDiv = this.utils.createElement('div', ['calendar-event', 'flex', 'items-center', 'text-[0.7rem]', 'px-1', 'py-0.5', 'rounded', 'bg-pink-100', 'w-full']);
                    bDayDiv.innerHTML = `<span class="text-event-aniversario font-bold mr-1">üéÇ</span> <span class="text-pink-700 truncate">${birthdaysOnThisDay.map(b => b.name.split(' ')[0]).join(', ')}</span>`;
                    bDayDiv.setAttribute('title', `Anivers√°rio: ${birthdaysOnThisDay.map(b => b.name).join(', ')}`);
                    eventsContainer.appendChild(bDayDiv); eventInfosForAria.push(`${birthdaysOnThisDay.length} aniversariante(s): ${birthdaysOnThisDay.map(b => b.name).join(', ')}`);
                }
                dayEl.appendChild(eventsContainer);
                if(eventInfosForAria.length > 0) { ariaLabelDay += `. Eventos: ${eventInfosForAria.join("; ")}`; }
                dayEl.setAttribute('aria-label', ariaLabelDay); fragment.appendChild(dayEl);
            }
            const totalCells = displayStartOffset + daysInMonth; const remainingCells = (totalCells % 7 === 0) ? 0 : 7 - (totalCells % 7);
            for (let i = 1; i <= remainingCells; i++) {
                const dayEl = this.utils.createElement('div', ['min-h-[90px]', 'p-1', 'rounded-md', 'bg-gray-50', 'border', 'border-gray-200', 'flex', 'flex-col', 'items-start', 'text-xs']);
                dayEl.setAttribute('role', 'gridcell'); dayEl.setAttribute('aria-label', `${i} (pr√≥ximo m√™s)`);
                dayEl.appendChild(this.utils.createElement('span', ['font-semibold', 'text-gray-400', 'self-end', 'p-1', 'leading-none'], {}, i.toString()));
                fragment.appendChild(dayEl);
            }
            calendarDaysContainer.appendChild(fragment);
        },
        setupEventListeners: function() {
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const downloadBirthdaysBtn = document.getElementById('download-birthdays');

            if (prevMonthBtn) {
                prevMonthBtn.addEventListener('click', () => {
                    this.state.currentDisplayDate.setMonth(this.state.currentDisplayDate.getMonth() - 1);
                    this.renderCalendar();
                });
            } else { console.error("Bot√£o #prev-month n√£o encontrado.");}
            if (nextMonthBtn) {
                nextMonthBtn.addEventListener('click', () => {
                    this.state.currentDisplayDate.setMonth(this.state.currentDisplayDate.getMonth() + 1);
                    this.renderCalendar();
                });
            } else { console.error("Bot√£o #next-month n√£o encontrado.");}
            if (downloadBirthdaysBtn) {
                downloadBirthdaysBtn.addEventListener('click', () => {
                    this.downloadBirthdaysSummary();
                });
            } else { console.error("Bot√£o #download-birthdays n√£o encontrado."); }
        },
        init: function() {
            this.state.currentDisplayDate = new Date(this.config.today.getFullYear(), this.config.today.getMonth(), 1);
            
            const todayFormatted = this.utils.formatDate(this.config.today, "AAAA-MM-DD");
            const tomorrowFormatted = this.utils.formatDate(new Date(new Date(this.config.today).setDate(this.config.today.getDate() + 1)), "AAAA-MM-DD");
            const threeDaysLaterFormatted = this.utils.formatDate(new Date(new Date(this.config.today).setDate(this.config.today.getDate() + 3)), "AAAA-MM-DD");
            const nextWeekFormatted = this.utils.formatDate(new Date(new Date(this.config.today).setDate(this.config.today.getDate() + 7)), "AAAA-MM-DD");

            // Adiciona aniversariantes din√¢micos √† lista existente
            this.data.birthdays.push(
                { name: "Ana Clara (Amanh√£)", date: tomorrowFormatted },
                { name: "Carlos Eduardo (Em 3 dias)", date: threeDaysLaterFormatted }
            );
            // Adiciona eventos din√¢micos √† lista existente
            this.data.churchEvents.push(
                { date: todayFormatted, time: "19:30", type: "culto", title: "Culto de Hoje", direcao: "Irm√£o Jos√©", pregador: "Irm√£ L√∫cia" },
                { date: nextWeekFormatted, time: "19:00", type: "culto", title: "Culto Pr√≥xima Semana", direcao: "Equipe Louvor", pregador: "Pr. Convidado Especial" }
            );

            if (!document.getElementById('cleaning-schedule') || !document.getElementById('birthdays') || !document.getElementById('calendar-days') || !document.getElementById('next-event-details') || !document.getElementById('worship-schedule-details')) {
                console.error("Um ou mais containers de se√ß√£o n√£o foram encontrados.");
            }
            this.renderNextEvent();
            this.renderCleaningSchedule();
            this.renderWorshipSchedule(); 
            this.renderBirthdays();
            this.renderCalendar();
            this.setupEventListeners();
            console.log("Painel da Igreja inicializado.");
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        PainelIgrejaApp.init();
    });
    </script>

</body>
</html>
